<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script>
        async function deleteUser(userId) {
            const token = localStorage.getItem("token");
            const response = await fetch(`/admin/users/${userId}`, {
                method: "DELETE",
                headers: { "Authorization": `Bearer ${token}` }
            });
            if (response.ok) location.reload();
        }
    </script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Admin Dashboard</a>
            <button class="btn btn-danger" onclick="logout()">Logout</button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">Users</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Settings</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <h1 class="mt-4">User Management</h1>
                
                <!-- Search -->
                <input type="text" class="form-control mb-3" id="searchUser" placeholder="Search user..." onkeyup="searchTable()">

                <!-- User Table -->
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% users.forEach(user => { %>
                                <tr>
                                    <td><%= user.id %></td>
                                    <td><%= user.name %></td>
                                    <td><%= user.email %></td>
                                    <td><%= user.role %></td>
                                    <td>
                                        <button class="btn btn-danger btn-sm" onclick="deleteUser(<%= user.id %>)">Delete</button>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
        function logout() {
            localStorage.removeItem("token");
            window.location.href = "/auth/login";
        }

        function searchTable() {
            let input = document.getElementById("searchUser").value.toLowerCase();
            let rows = document.querySelectorAll("tbody tr");

            rows.forEach(row => {
                let name = row.cells[1].innerText.toLowerCase();
                let email = row.cells[2].innerText.toLowerCase();
                row.style.display = name.includes(input) || email.includes(input) ? "" : "none";
            });
        }
    </script>
</body>
</html>
